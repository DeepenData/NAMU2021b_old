---
title: "R Notebook"
output: html_notebook
---


```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(clusterProfiler)
library(DOSE)
library(ReactomePA)
library(readr)

path = "~/AA_PostDoc/human-metnet/"


rxns  <- read_csv(paste0(path,"data/recon2_rxn_info.csv")) %>% column_to_rownames("X1")
genes <- read_csv(paste0(path,"data/recon2_genes_to_rxns.csv")) %>% column_to_rownames("X1")
negative_fold_change  <- read_csv(paste0(path,"results/PKU_recon2rxn_top_negative_fold_change.csv")) %>% column_to_rownames("X1")
positive_fold_change  <- read_csv(paste0(path,"results/PKU_recon2rxn_top_positive_fold_change.csv")) %>% column_to_rownames("X1")

get_genes <- function(a_rxn){return(genes %>% filter(str_detect(Reactions, regex(a_rxn, ignore_case = T))) %>%
                            .[["Gene_ID"]] %>% str_trim %>% str_extract_all("^\\d+") %>% unlist())}
get_genes_by_centrality <- function(FC){
                                      centrality_to_genes <- function(centrality_names){FC[[centrality_names]]  %>% map(get_genes) %>% unlist %>% unique %>% return}
                                      FC %>% colnames() -> centrality_names
                                     centrality_names %>%  map(centrality_to_genes) %>% purrr::set_names(centrality_names) -> genes_by_centrality
                                     return(genes_by_centrality)}



get_genes_by_centrality(negative_fold_change) -> genes_negative_fold_change

get_genes_by_centrality(positive_fold_change) -> genes_positive_fold_change
```

```{r fig.height=4, fig.width=20, message=FALSE, warning=FALSE}
compareCluster(genes_positive_fold_change, fun='enrichDGN', pvalueCutoff=0.01) -> clusters_plot
clusters_plot %>% dotplot
```

```{r}

_fold_change  <- read_csv(paste0(path,"results/PKU_recon2rxn_top_negative_fold_change.csv")) 




```


###########################################################

```{r fig.height=4, fig.width=25, message=FALSE, warning=FALSE}

compareCluster(genes_positive_fold_change, fun='enrichPathway', pvalueCutoff=0.001) -> clusters_plot
clusters_plot %>% dotplot
```

```{r fig.height=3, fig.width=20, message=FALSE, warning=FALSE}
compareCluster(genes_negative_fold_change, fun='enrichPathway', pvalueCutoff=0.001) -> clusters_plot
clusters_plot %>% dotplot
```


```{r fig.height=3, fig.width=20, message=FALSE, warning=FALSE}
compareCluster(genes_negative_fold_change, fun='enrichDGN', pvalueCutoff=0.01) -> clusters_plot
clusters_plot %>% dotplot
```




