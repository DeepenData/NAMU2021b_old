---
title: "R Notebook"
output: html_notebook
---



```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(ggpubr)
path_figure_1 = "~/PostDoc/human-metnet/results/stimulated_NAMU_results_analysis_in_R_rmd/Figure_1/"
path_figure_2 = "~/PostDoc/human-metnet/results/stimulated_NAMU_results_analysis_in_R_rmd/Figure_2/"
path_figure_3 = "~/PostDoc/human-metnet/results/stimulated_NAMU_results_analysis_in_R_rmd/Figure_3/"
id_name <- read_rds(paste0(path_figure_1, "all_data.rds")) %>% .[[1]] %>% select(c("ID", "Name" ))
Centrality      <- read_csv(paste0(path_figure_2, "total_centrality_by_node.csv"))  %>% filter(Centrality > 0.5) 
Optimality      <- read_csv(paste0(path_figure_3, "optimality_values.csv"))
Node_attributes <- read_csv(paste0(path_figure_3, "node_attributes.csv"))
Optimality <- inner_join(Node_attributes, Optimality)
Centrality <- inner_join(Node_attributes, Centrality)
Optimality <- inner_join(id_name, Optimality)
Centrality <- inner_join(id_name, Centrality)
inner_join(Optimality, Centrality) -> hyperhubs
nrow(hyperhubs) /nrow(Centrality)
nrow(hyperhubs) /nrow(Optimality)
hyperhubs %>% filter(Node == 'Astrocyte' | Node == 'Neuron') -> hyperhubs
colnames(hyperhubs) <- c("ID"  , "Name",        "Reaction" ,  "Node"   ,    "Optimal"   ,  "Central")
```
```{r fig.height=9, fig.width=6, message=FALSE, warning=FALSE, paged.print=FALSE}
library(scales)
library(magrittr)
library(ggplot2)
hyperhubs %<>%mutate(Optimal = rescale(Optimal, to = c(0, 1)), Central = rescale(Central, to = c(0, 1))) 
hyperhubs %<>% mutate(Hubness = Optimal + Central)
hyperhubs %>% select(ID,Name,Optimal,Node) ->hyperhubs_Optimal
hyperhubs %>% select(ID,Name,Central,Node) ->hyperhubs_Central
plot_sorted_nodes <- function(df, varname_values, x_lab, y_lab, leg_pos, mycolors, y_labels ="ID"){df %>% 
  ggplot(aes(y= reorder(.data[[y_labels]],  .data[[varname_values]]),x= .data[[varname_values]], fill = Node)) + 
  geom_col()+  scale_fill_manual(values=mycolors) +
    theme(axis.ticks.y=element_blank(), 
          axis.text.y= element_text(NA, angle = 0, size=7),
        panel.border = element_rect(linetype = "solid", fill = NA),
        legend.position = leg_pos)+ 
        labs(x = x_lab, y = y_lab)}
c("deepskyblue3", "brown2") -> mycolors
"Score"                -> x_lab
'Hyper-hubs'-> y_lab
'right'                       -> leg_pos
hyperhubs %>% plot_sorted_nodes('Hubness' , x_lab, y_lab, leg_pos, mycolors, y_labels = "Name") 
```










